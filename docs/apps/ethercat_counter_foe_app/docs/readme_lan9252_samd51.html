<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>EVB LAN9252 SAMD51 Application | EtherCAT Library and Applications</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="EVB LAN9252 SAMD51 Application" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 EtherCAT package" /> <meta property="og:description" content="Harmony 3 EtherCAT package" /> <link rel="canonical" href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html" /> <meta property="og:url" content="../../../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html" /> <meta property="og:site_name" content="EtherCAT Library and Applications" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"EVB LAN9252 SAMD51 Application","url":"../../../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 EtherCAT package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../index.html" class="nav-list-link">EtherCAT Library and Applications</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../driver/readme.html" class="nav-list-link">EtherCAT LAN925x Library</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../driver/docs/readme_drvlan9252.html" class="nav-list-link">EtherCAT LAN9252 Library</a> </li><li class="nav-list-item "> <a href="../../../driver/docs/readme_drvlan9255.html" class="nav-list-link">EtherCAT LAN9255 Library</a> </li><li class="nav-list-item "> <a href="../../../driver/docs/readme_drvlan9253.html" class="nav-list-link">EtherCAT LAN9253 Library</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../apps/ethercat_counter_foe_app/readme.html" class="nav-list-link">EtherCAT Counter FoE Application</a><ul class="nav-list"><li class="nav-list-item active"> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html" class="nav-list-link active">EVB LAN9252 SAMD51 Application</a> </li><li class="nav-list-item "> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html" class="nav-list-link">EVB LAN9253 SAMD51 Application</a> </li><li class="nav-list-item "> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51_sqi.html" class="nav-list-link">EVB LAN9253 SAMD51 Application SQI Communication</a> </li><li class="nav-list-item "> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9255_same53_spi.html" class="nav-list-link">EVB LAN9255 SAME53 Application SPI Communication</a> </li><li class="nav-list-item "> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9255_same53_sqi.html" class="nav-list-link">EVB LAN9255 SAME53 Application SQI Communication</a> </li></ul></li><li class="nav-list-item "><a href="../../../apps/docs/readme_ssctool.html" class="nav-list-link">Slave Stack Code Generation</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search EtherCAT Library and Applications" aria-label="Search EtherCAT Library and Applications" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../../index.html">EtherCAT Library and Applications</a></li> <li class="breadcrumb-nav-list-item"><a href="../../../apps/ethercat_counter_foe_app/readme.html">EtherCAT Counter FoE Application</a></li> <li class="breadcrumb-nav-list-item"><span>EVB LAN9252 SAMD51 Application</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="Microchip logo" /></a> <img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small" /></p> <h1 id="ethercat-trigger--counter-and-foe-application-for-evm_lan9252_samd51"> <a href="#ethercat-trigger--counter-and-foe-application-for-evm_lan9252_samd51" aria-labelledby="ethercat-trigger--counter-and-foe-application-for-evm_lan9252_samd51" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> EtherCAT Trigger &amp; Counter and FoE Application for EVM_LAN9252_SAMD51 </h1> <p>This EtherCAT example application demonstrates Firmware Update over EtherCAT capability.The Counter and Trigger parameters are configured in the <strong>&lt; ethercat repo &gt;/apps/ethercat_counter_foe_app/firmware/src/slave_stack/lan9252</strong> and demonstrates the communication between the EtherCAT Manager (TwinCAT Manager) and the EtherCAT Client (EtherCAT LAN9252). The firmware update is performed by FoE (File over EtherCAT) protocol. It is triggered by the EtherCAT Manager (TwinCAT Manager) which then download the firmware onto the EtherCAT Client (LAN9252) on the EVB_LAN9252_SAMD51 board.</p> <p><strong>Note :</strong> The EtherCAT Library can also be configured to execute on other EthertCAT development boards available from Microchip. Additional instruction at available in the <a href="https://github.com/Microchip-MPLAB-Harmony/ethercat/wiki/create-your-first-ethercat-application">Create your first EtherCAT Application</a> section.</p> <p>This demonstration help document contains the following sections:</p> <ol> <li>MPLAB® Harmony Software Setup</li> <li>Hardware Setup</li> <li>Beckhoff Slave Stack Code (SSC) Generation</li> <li>MPLAB® Harmony Project Configuration</li> <li>Completing The EtherCAT Application</li> <li>Running The Application <ol> <li>TwinCAT Manager and Microchip EtherCAT Client communication <ol> <li>EtherCAT interface detect and EEPROM Programming</li> <li>Trigger and Counter Demonstration</li> <li>File over EtherCAT communication</li> </ol> </li> </ol> </li> </ol> <h2 id="1-mplab-harmony-software-setup"> <a href="#1-mplab-harmony-software-setup" aria-labelledby="1-mplab-harmony-software-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. <strong>MPLAB® Harmony Software Setup</strong> </h2> <p>The following MPLAB® software components are a prerequisite for the subsequent steps in this demonstration. Please follow the download and installation instructions available at below links.</p> <ul> <li><a href="https://www.microchip.com/mplab/mplab-x-ide">MPLAB® X Integrated Development Environment</a></li> <li><a href="https://www.microchip.com/mplab/compilers">MPLAB® XC32/32++ C Compiler</a></li> <li><a href="https://github.com/Microchip-MPLAB-Harmony/">MPLAB® Harmony Configurator</a></li> <li>On the management PC, download and install the TwinCAT 3 Engineering Full Setup at https://www.beckhoff.com/english.asp?download/tc3-download-xae.htm. Select the latest TwinCAT 3.1 Version and click on the link. Note the dialog box that shows the TwinCAT tool to be installed <strong>TC31-Full-Setup.3.1.XXXX.XX</strong> and click on “Start Download”. Follow instructions to download.</li> </ul> <h2 id="2-hardware-setup"> <a href="#2-hardware-setup" aria-labelledby="2-hardware-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. <strong>Hardware Setup</strong> </h2> <p>The following tools will be used to program and debug the application on the target hardware.</p> <ul> <li><a href="https://www.microchip.com/DevelopmentTools/ProductDetails/DV164045">MPLAB® ICD4</a> + ICD4/PICKIT 3 Target Adapter Board using JTAG interface.</li> </ul> <p>The following development board will be used to develop and execute the EtherCAT application.</p> <ul> <li> <p><a href="https://www.microchip.com/DevelopmentTools/ProductDetails/PartNO/EV44C93A#additional-summary">LAN9252 - EtherCAT Client Controller evaluation kit with SAMD51 Microcontroller</a></p> <p>The instructions in this guide are also applicable to other development boards with LAN9252 EtherCAT client device. Hardware settings are board dependent and may vary between boards.</p> </li> <li>Connect a micro USB cable to port J8 to power the board..</li> <li>For programming, connect a ICD4 JTAG cable to port J10 of the EVB_LAN9252_SAMD51 board.</li> <li> <p>Connect RJ45 connector J1 to the TwinCAT Manager.</p> </li> <li> <p>Block diagram of the EVB_LAN9252_SAMD51 board -</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/evb_lan925x_samd51_block_diagram.png" alt="EVB_LAN9252_SAMD51" /></p> </li> </ul> <h2 id="3-beckhoff-slave-stack-code-ssc-generation"> <a href="#3-beckhoff-slave-stack-code-ssc-generation" aria-labelledby="3-beckhoff-slave-stack-code-ssc-generation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. <strong>Beckhoff Slave Stack Code (SSC) Generation</strong> </h2> <p>Follow instruction at this link to generate Beckhoff Slave Stack Code: <a href="../../../apps/docs/readme_ssctool.html">Steps to generate Beckhoff Slave Stack Code </a></p> <h2 id="mplab-harmony-project-configuration"> <a href="#mplab-harmony-project-configuration" aria-labelledby="mplab-harmony-project-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>MPLAB® Harmony Project Configuration</strong> </h2> <p>There are two options available for downloading/installing the MPLAB® Harmony Software Repositories from github &amp; gitee.</p> <p>The required repositories can be cloned from the github (or gitee) by using a local git client (such git bash). The MPLAB® Harmony Repositories are available at the following links:</p> <p><a href="https://github.com/Microchip-MPLAB-Harmony/">https://github.com/Microchip-MPLAB-Harmony/</a></p> <p><a href="https://gitee.com/Microchip-MPLAB-Harmony/">https://gitee.com/Microchip-MPLAB-Harmony/</a></p> <p>The <strong>csp, dev_packs, mhc and ethercat</strong> repositories should be cloned. The required repositories can also be cloned (downloaded) or previously downloaded repositories can also be updated by using the MPLAB® Harmony 3 Content Manager. The following sections provide details on using the MPLAB® Harmony 3 Content Manager to download the repositories.</p> <ol> <li> <p>Refer to the EtherCAT <strong>MPLAB® Harmony Software Setup</strong> https://github.com/Microchip-MPLAB-Harmony/ethercat/wiki/create-your-first-ethercat-application for details about creating an EtherCAT project.</p> </li> <li> <p>The following Project Graph diagram shows the MPLAB® Harmony Library components that are required by the FoE EtherCAT application on the EVB_LAN9252_SAMD51 board.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_project.png" alt="ethercat_mhc_image" /></p> </li> <li>Click on the EtherCAT Stack in the Project Graph window. In the Configuration window, <ul> <li>The <strong>Slave Stack source directory path</strong> should point to the folder that contains the files generated by the SSC tool.</li> <li>The <strong>Enable FoE</strong> checkbox enables <strong>File over EtherCAT</strong> feature.</li> </ul> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_slave_object_configuration.png" alt="ethercat_mhc_image" /></p> </li> <li>Click on <strong>LAN9252</strong> component from the project graph. <ul> <li><strong>EtherCAT Interrupt Priority Level</strong> :- This defines a interrupt priority range. All application interrupts whose priority is more than or equal to this level will be disabled during an EtherCAT interrupt service routine execution.</li> <li> <p>Following table maps EtherCAT interrupt name with respective peripheral channel selection. <strong>EIC interrupt handler and the SPI chip select Configuration for EVB_LAN9252_SAMD51</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th>Interrupt Name</th> <th style="text-align: center">EIC Channel</th> </tr> </thead> <tbody> <tr> <td>SYNC0 Interrupt</td> <td style="text-align: center">EIC_EXTINT0</td> </tr> <tr> <td>SYNC1 Interrupt</td> <td style="text-align: center">EIC_EXTINT1</td> </tr> <tr> <td>IRQ Interrupt</td> <td style="text-align: center">EIC_EXTINT7</td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Other Usage</th> <th style="text-align: center">Port Pin</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">SPI Chip Select</td> <td style="text-align: center">PORT RB11</td> </tr> <tr> <td style="text-align: center">Error Select Pin</td> <td style="text-align: center">PORT RB31</td> </tr> </tbody> </table></div> </li> </ul> <p><strong>NOTE</strong> - EIC/GPIO/PIO pins for External event registration and event handler processing can be selected based on the micrcontroller and LAN9252 interrupt support.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/lan925x_configuration_option.png" alt="ethercat_mhc_image" /></p> </li> <li> <p><strong>EIC</strong>, <strong>QSPI</strong> and <strong>TC0</strong> are configured as per the application requirement.</p> </li> <li> <p>The below PINs are configured for the application</p> <ul> <li> <p><strong>QSPI PIN Configuration for EVB_LAN9252_SAMD51</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">QSPI Custom Name</th> <th style="text-align: center">Function</th> <th style="text-align: center">PORT PIN ID</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">QSPI_MOSI</td> <td style="text-align: center">QSPI_DATA0</td> <td style="text-align: center">PA08</td> </tr> <tr> <td style="text-align: center">QSPI_MISO</td> <td style="text-align: center">QSPI_DATA1</td> <td style="text-align: center">PA09</td> </tr> <tr> <td style="text-align: center">QSPI_SCK</td> <td style="text-align: center">QSPI_SCK</td> <td style="text-align: center">PB10</td> </tr> <tr> <td style="text-align: center">SPI_CS</td> <td style="text-align: center">GPIO</td> <td style="text-align: center">PB11</td> </tr> </tbody> </table></div> </li> <li> <p><strong>PIN Configuration for EtherCAT External Interrupt Pins for EVB_LAN9252_SAMD51</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">EIC Custom Name</th> <th style="text-align: center">EIC Channel</th> <th style="text-align: center">Port Pin</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">EIC_EXTINT0</td> <td style="text-align: center">EIC_EXTINT0</td> <td style="text-align: center">PORT PB16</td> </tr> <tr> <td style="text-align: center">EIC_EXTINT1</td> <td style="text-align: center">EIC_EXTINT1</td> <td style="text-align: center">PORT PB17</td> </tr> <tr> <td style="text-align: center">EIC_EXTINT7</td> <td style="text-align: center">EIC_EXTINT7</td> <td style="text-align: center">PORT PB23</td> </tr> </tbody> </table></div> </li> </ul> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/required_pin_configuration.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>Open <strong>NVIC configuration</strong> window from MHC→Tools. Set the QSPI Interrupt Priority Level to 2. This interrupt priority level is selected to be less than value of the <strong>EtherCAT Interrupt Priority Level</strong> configuration option in the <strong>LAN9252</strong> component.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/nvic_QSPI_priority_change.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>The application will use the default clock options. No changes are required in clock settings.</p> </li> <li> <p>The FoE application uses a customized linker file. The <strong>ROM_LENGTH</strong> attribute in the linker file is modified to 0x40000 for ATSAMD51J19A. Bank A memory range is configured between 0x00000 to 0x3FFFF. Bank B memory range is configured between 0x40000 to 0x7FFFF.</p> <p>The <strong>Dual Bank</strong> feature enables the FoE firmware to be executed from one bank while an updated version of the firmware is programmed into the other bank. The APP_BankSwitch() application function is called to swap the banks and to reset the device when the programming is complete. The APP_RunApplication() function is called to execute the new firmware.</p> <p>To add a customized linker file to the project, uncheck the <strong>Add linker file to project</strong> option. Navigate to <strong>System&gt;Project Configuration&gt;Tool Chain Selections&gt;Add linker file</strong> in the MHC Project graph to add the customized linked script file.</p> <p>See the below screen capture: <br /> <img src="../../../apps/ethercat_counter_foe_app/docs/images/foe_linkerfile_toProject.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>Generate the code by clicking the <strong>Generate Code</strong> button (marked in red).</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_demo_project_generation_1.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>The following diagram shows the generated EtherCAT project. This contains the <strong>sample_app.c</strong> file. It does not contain the Beckhoff Slave stack code. The Beckhoff Slave Stack Code should be generated using the SSC tool with the required configuration and the Microchip-SAMD51-EtherCAT-Slave_SSC_Config.xml file. The folder view on the right side in the below figure shows the EtherCAT project with SSC stack files added to the folder.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/generated_slave_stack_code.png" alt="ethercat_mhc_image" /></p> </li> </ol> <h2 id="4-completing-the-ethercat-application"> <a href="#4-completing-the-ethercat-application" aria-labelledby="4-completing-the-ethercat-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. <strong>Completing The EtherCAT Application</strong> </h2> <p>At this point, the FoE application MPLAB® X IDE project is ready along with the SSC Tool generated code. The following section describes the steps to be followed to update the FoE application files. The below table lists the MPLAB® X projects available for the demonstration. The MPLAB® X project mentioned in this table is available at <strong>&lt; install-dir &gt;/ethercat/apps/ethercat_counter_foe_app/firmware</strong>.</p> <ol> <li> <p>MPLAB® X Project table</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Project Name</th> <th style="text-align: center">Target Device</th> <th style="text-align: center">Target Development board</th> <th style="text-align: center">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">sam_d51_lan9252_evb.X</td> <td style="text-align: center">ATSAMD51J19A</td> <td style="text-align: center">EVB-LAN9252_SAMD51</td> <td style="text-align: center">ETherCAT evaluation board with LAN9252</td> </tr> </tbody> </table></div> </li> <li> <p>The project contains the MPLAB® Harmony components that are required for an EtherCAT application. The application files need to be added to the project.</p> </li> </ol> <p>The application source files to be added to the project, the <strong>ethercat_counter_foe_app</strong> demo, are available in <strong>Harmony_Repo_Path/h3/ethercat/apps/ethercat_counter_foe_app/firmware/src</strong> folder.</p> <ol> <li> <p>The <strong>app.c</strong>, <strong>app.h</strong>, <strong>main.c</strong> files are updated to demonstrate the application.</p> </li> <li> <p>The <strong>apps/ethercat_counter_foe_app/firmware/src/config/sam_d51_lan9252_evb/ethercat_foe.ld</strong> linker file is a modified linker file to be used in the FOE application.</p> </li> <li> <p>The sample application files <strong>sample_app.c</strong>, <strong>sample_app.h</strong> and <strong>sample_appObjects.h</strong>, generated by SSC tool, are updated for the application requirement.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_sample_app.png" alt="ethercat_build_application" /></p> <p>The SSC tool generated sample application files, highlighted in the above screen capture above, are updated for Counter, Trigger peripheral interface and for the FoE read/write operations. These are available in the <strong>apps/ethercat_counter_foe_app/firmware/src/slave_stack</strong> folder.</p> </li> <li> <p>Verify the <strong>XC32</strong> Compiler Toolchain version and set the <strong>Connected Hardware Tool</strong> to <strong>ICD4</strong>, if this is connected to J10, or <strong>PICkit 3</strong>. Press <strong>Apply</strong> button and then press <strong>OK</strong> button.</p> </li> <li> <p>Build the application by clicking on the <strong>Build Main Project</strong>.</p> </li> </ol> <h2 id="5-running-the-application"> <a href="#5-running-the-application" aria-labelledby="5-running-the-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. <strong>Running The Application</strong> </h2> <h3 id="1-twincat-manager-and-microchip-ethercat-client-communication"> <a href="#1-twincat-manager-and-microchip-ethercat-client-communication" aria-labelledby="1-twincat-manager-and-microchip-ethercat-client-communication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. <strong>TwinCAT Manager and Microchip EtherCAT Client communication</strong> </h3> <h4 id="1-ethercat-interface-detect-and-eeprom-programming"> <a href="#1-ethercat-interface-detect-and-eeprom-programming" aria-labelledby="1-ethercat-interface-detect-and-eeprom-programming" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. EtherCAT interface detect and EEPROM Programming </h4> <ol> <li> <p>Upon successful installation of the TwinCAT Manager, the network adapter will be moved to Installed and ready to use devices section as shown in the following figure.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/eth_adapter_ready_to_use.png" alt="Application_Execut" /></p> <p>Copy the available <strong>SAMD51_EtherCAT_Slave.xml</strong> file from <strong>&lt; harmony-repo &gt;app/ethercat/slave_stack/lan9252/</strong> directory to the <strong>TwinCAT\3.1\Config\Io\EtherCAT</strong> directory.</p> </li> <li> <p>In TwinCAT XAE, create a New Project <strong>(File=&gt;New=&gt;Project)</strong>. In the New Project Window, select the TwinCAT Projects option and then click OK</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_new_project.png" alt="Application_Execute" /></p> </li> <li> <p>Connect port zero (J1 connector) of the EVB_LAN9252_SAMD51 board to the TwinCAT Server using a RJ45 Ethernet cable, and then power up the board. The Link/Act LED should be ON at Port zero when the cable is connected. If the Link/Act LED is not ON, then this indicates that there is an issue with the connection or the cable.</p> </li> <li> <p>Expand the IO option in the TwinCAT XAE project window and right click on Devices. Select Scan.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_scan_new_devices.png" alt="Application_Execute" /></p> </li> <li> <p>Click OK if the TwinCAT network interface is selected and continue scanning as shown in the below image.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/scanned_twincat_network_interface.png" alt="Application_Execute" /></p> </li> <li> <p>Click OK to continue scanning and Click Yes in the Scan for boxes prompt.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/device_confirmation_box.png" alt="Application_Execute" /></p> </li> <li> <p><strong>EEPROM Programming</strong> After a successful scan, click on Device 2 (EtherCAT) in the solution explorer window of the TwinCAT tool and Click Online in the TwinCAT project window. Once this is done, highlight the Device. This should read OP.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_eeprom_update.png" alt="Application_Execute" /></p> </li> </ol> <h4 id="2-trigger-and-counter-demonstration"> <a href="#2-trigger-and-counter-demonstration" aria-labelledby="2-trigger-and-counter-demonstration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Trigger and Counter Demonstration </h4> <p>This section describes the Tigger ( Output value for the TwinCAT manager and Input value to the LAN9253 EtherCAT device ) parameter and the Counter (Input value to the TwinCAT manager and Output value for the LAn9253 EtherCAT device ) parameter configuration. Counter parameter value is determined based on Trigger parameter value. If Trigger parameter value is 0, then Counter parameter is cleared. Trigger parameter value is used to determine value of Counter parameter.</p> <ol> <li> <p><strong>Input Trigger configuration</strong> - From I/O level on the Solution Explorer (left window), go to <strong>Devices=&gt;Device # (EtherCAT)=&gt;Box 1 (SAMD51 EtherCAT Slave)=&gt;Outputs process data mapping=&gt;Trigger</strong>.</p> </li> <li> <p>In the top center window, select Online tab. Click Write and then enter <strong>1</strong> in Decimal: field and click OK.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_start_trigger.png" alt="Application_Execute" /></p> </li> <li> <p><strong>Output Counter Observation</strong> - From I/O level on the Solution Explorer (left window), go to <strong>Devices=&gt;Device # (EtherCAT)=&gt;Box 1 (SAMD51 EtherCAT Slave)=&gt;Inputs process data mapping=&gt;Counter</strong>.</p> </li> <li> <p>In the top center window, select Online tab. The counter value should be incrementing.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_output_counter.png" alt="Application_Execute" /></p> </li> </ol> <h4 id="3-file-over-ethercat-communication"> <a href="#3-file-over-ethercat-communication" aria-labelledby="3-file-over-ethercat-communication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. File over EtherCAT communication </h4> <ol> <li> <p><strong>FoE (File over EtherCAT) Test Update</strong> - Click on Box1, Select “Online” tab. Before FoE test <strong>Curent state</strong> and <strong>Requested state</strong> should be in <strong>OP</strong> mode.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/before_foe.png" alt="Application_Execute" /></p> </li> <li> <p>For file download, change the mode from INIT to BOOT mode.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/init_to_boot_mode.png" alt="Application_Execute" /></p> </li> <li> <p>After clicking <strong>Download</strong> button , select <strong>BIN</strong> file that needs to be downloaded and configure the <strong>Password</strong> as per the <strong>EtherCAT component password</strong> configuration.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/download_bin_file_using_foe.png" alt="Application_Execute" /></p> <p>The sample <strong>BIN</strong> files present in the <strong>&lt; harmony-repo &gt;/ethercat/apps/ethercat_counter_foe_app/firmware/src/FoE_Bin_imagefiles/lan9252_foe_binfiles</strong> folder can be used to verify the operation of the FoE application.</p> <p><strong>NOTE</strong> - A <strong>BIN</strong> file can be generated from the generated EtheCAT <strong>HEX</strong> image after configuring the <strong>Project Properties-&gt;Conf:-&gt;Building-&gt;Execute This Line After Build</strong> as such: ${MP_CC_DIR}/xc32-objcopy” -I ihex -O binary “${DISTDIR}/${PROJECTNAME}.${IMAGE_TYPE}.hex” “${DISTDIR}/${PROJECTNAME}.${IMAGE_TYPE}.bin</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/HextoBinFileConversion.png" alt="Application_Execute" /></p> <p><strong>NOTE</strong> - The <strong>Execute This Line After Build</strong> option should be unchecked in debug mode.</p> </li> <li> <p>The download process can be tracked as shown in the figure below-</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/download_bin_file_is_is_process.png" alt="Application_Execute" /></p> </li> <li> <p>After successful download, change the state from BOOT to INIT mode. This helps the application switch the bank from BANK B to BANK A and the newly downloaded firmware will be executed from BANK A. The new application starts running from flash location 0x0.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/after_file_download_boot_to_init_mode.png" alt="Application_Execute" /></p> </li> </ol> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
