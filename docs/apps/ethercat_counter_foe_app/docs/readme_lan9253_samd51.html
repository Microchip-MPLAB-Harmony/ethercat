<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>EVB LAN9253 SAMD51 Application - EtherCAT Library and Applications</title> <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-2724382-16"); </script> <script type="text/javascript" src="../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>EVB LAN9253 SAMD51 Application | EtherCAT Library and Applications</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="EVB LAN9253 SAMD51 Application" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 EtherCAT package" /> <meta property="og:description" content="Harmony 3 EtherCAT package" /> <link rel="canonical" href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html" /> <meta property="og:url" content="../../../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html" /> <meta property="og:site_name" content="EtherCAT Library and Applications" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"EVB LAN9253 SAMD51 Application","url":"../../../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 EtherCAT package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item"><a href="../../../mplab_harmony_license.html" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="../../../release_notes.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../../index.html" class="navigation-list-link">EtherCAT Library and Applications</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="../../../driver/readme.html" class="navigation-list-link">EtherCAT LAN925x Library</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="../../../driver/docs/readme_drvlan9253.html" class="navigation-list-link">EtherCAT LAN9253 Library</a> </li></ul></li><li class="navigation-list-item active"><a href="../../../apps/ethercat_counter_foe_app/readme.html" class="navigation-list-link">EtherCAT Counter FoE Application</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html" class="navigation-list-link">EVB LAN9252 SAMD51 Application</a> </li><li class="navigation-list-item active"> <a href="../../../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html" class="navigation-list-link active">EVB LAN9253 SAMD51 Application</a> </li></ul></li><li class="navigation-list-item "><a href="../../../apps/docs/readme_ssctool.html" class="navigation-list-link">Slave Stack Code Generation</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search EtherCAT Library and Applications" aria-label="Search EtherCAT Library and Applications" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="https://support.microchip.com">Obtain Support from Microchip</a></li> </ul> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../../index.html">EtherCAT Library and Applications</a></li> <li class="breadcrumb-nav-list-item"><a href="../../../apps/ethercat_counter_foe_app/readme.html">EtherCAT Counter FoE Application</a></li> <li class="breadcrumb-nav-list-item"><span>EVB LAN9253 SAMD51 Application</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="Microchip logo" /></a> <img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small" /></p> <h1 id="ethercat-counter-foe-application-for-evm_lan9253_samd51"> <a href="#ethercat-counter-foe-application-for-evm_lan9253_samd51" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> EtherCAT Counter FoE Application for EVM_LAN9253_SAMD51 </h1> <p>This EtherCAT example application demonstrates the capable of doing firmware updates via FoE (File over EtherCAT) and EtherCAT Master ( TwinCAT Master ) slave ( EtherCAT LAN9253) communication with EVB_LAN9253_SAMD51 micro-controller. Microchip’s EtherCAT provides the information about how to configure and run the application on different EtherCAT platform.</p> <ol> <li>MPLAB® Harmony Software Setup</li> <li>Hardware Setup</li> <li>MPLAB Harmony configuration</li> <li>Build The EtherCAT Application</li> <li>Running The Application <ol> <li>Slave Stack Code (SSC) Generation</li> <li>TwinCAT Manager and Microchip EtherCAT Slave communication <ol> <li>TwinCAT EtherCAT interface detect and EEPROM Programming</li> <li>Trigger and Counter Demonstration</li> <li>File over EtherCAT communication</li> </ol> </li> </ol> </li> </ol> <h2 id="mplab-harmony-software-setup"> <a href="#mplab-harmony-software-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>MPLAB® Harmony Software Setup</strong> </h2> <p>The following MPLAB® software components are a prerequisite for the rest of the steps in this demonstration. Please follow the download and installation instructions available at below links.</p> <ul> <li><a href="https://www.microchip.com/mplab/mplab-x-ide">MPLAB® X Integrated Development Environment</a></li> <li><a href="https://www.microchip.com/mplab/compilers">MPLAB® XC32/32++ C Compiler</a></li> <li><a href="https://github.com/Microchip-MPLAB-Harmony/">MPLAB® Harmony Configurator</a></li> <li>On the management PC, download and Install on the TwinCAT 3 Engineering Full Setup at https://www.beckhoff.com/english.asp?download/tc3-download-xae.htm. Select the latest TwinCAT 3.1 Version and click on the link. Note the dialog box shows the TwinCAT tool that will be installed <strong>TC31-Full-Setup.3.1.XXXX.XX</strong> and click on “Start Download”. Follow instructions to download.</li> </ul> <h2 id="hardware-setup"> <a href="#hardware-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>Hardware Setup</strong> </h2> <p>The following tools can be used to program and debug the application on the target hardware.</p> <ul> <li><a href="https://www.microchip.com/DevelopmentTools/ProductDetails/DV164045">MPLAB® ICD4</a> + ICD4/PICKIT 3 Target Adapter Board using JTAG interface.</li> </ul> <p>The following development board will be used to develop and run EtherCAT application for the SAMD51 device family. The instructions in this guide are applicable to any of these development boards. Hardware settings are board dependent and may vary between boards.</p> <ul> <li> <p><a href="https://www.microchip.com/DevelopmentTools/ProductDetails/PartNO/EV44C93A#additional-summary">SAMD51 LAN9253 Evaluation Board Details</a></p> </li> <li>Connect a micro USB cable to J8 port for power source.</li> <li>For programming, Connect a ICD4 JTAG cable to the J10 port of the EVB_LAN9253_SAMD51.</li> <li> <p>RJ45 connector is connected to the TwinCAT Manager using J1 port.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/evb_lan925x_samd51_img.png" alt="EVB_LAN9253_SAMD51" /></p> </li> <li> <p>Block diagram of the EVB_LAN9253_SAMD51 board -</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/evb_lan9253_samd51_block_diagram.png" alt="EVB_LAN9253_SAMD51" /></p> </li> <li> <p>Complete HW Setup</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/lan925x_samd51_ICD4_setup.png" alt="EVB_LAN9253_SAMD51" /></p> </li> </ul> <h2 id="mplab-harmony-configuration"> <a href="#mplab-harmony-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>MPLAB Harmony configuration</strong> </h2> <p>There are two options available for downloading/installing the MPLAB® Harmony Software Repositories from github &amp; gitee.</p> <p>The required repositories can be cloned from the github (or gitee) by using a local git client (such git bash). The MPLAB® Harmony Repositories are available at the following links:</p> <p><a href="https://github.com/Microchip-MPLAB-Harmony/">https://github.com/Microchip-MPLAB-Harmony/</a></p> <p><a href="https://gitee.com/Microchip-MPLAB-Harmony/">https://gitee.com/Microchip-MPLAB-Harmony/</a></p> <p>The <strong>csp, dev_packs, mhc and ethercat</strong> repositories should be cloned. The repositories can also be cloned (downloaded) or previously downloaded repositories can be updated by using the MPLAB® Harmony 3 Content Manager. The following sections provide details on using the MPLAB® Harmony 3 Content Manager to download the repositories.</p> <ol> <li> <p>Refer to the EtherCAT <strong>MPLAB® Harmony Software Setup</strong> https://github.com/Microchip-MPLAB-Harmony/ethercat/wiki/create-your-first-ethercat-application details to create a EtherCAT project.</p> </li> <li> <p>The following Project Graph diagram shows the required Harmony components which are included for the present EtherCAT application for the EVB_LAN9253_SAMD51.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_project_lan9253.png" alt="ethercat_mhc_image" /></p> </li> <li>Click on the EtherCAT Stack in the Project Graph window. In the Configuration window, <ul> <li>The <strong>Slave Stack source directory path</strong> points to the folder that contains the files generated by the SSC tool.</li> <li><strong>Enable FoE</strong> checkbox enables <strong>File over EtherCAT</strong> feature.</li> </ul> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_slave_object_configuration_lan9253.png" alt="ethercat_mhc_image" /></p> </li> <li>Click on <strong>LAN9253</strong> component from the project graph. <ul> <li><strong>EtherCAT Interrupt Priority Level</strong> :- This is the range, equal to or more than this value, all the interrupts will be disabled during EtherCAT interrupt handler in process.</li> <li> <p>Following table maps EtherCAT interrupt name with respective peripheral channel selection. <strong>EIC interrupt handler and the SPI chip select Configuration for EVB_LAN9253_SAMD51</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th>Interrupt Name</th> <th style="text-align: center">EIC Channel</th> </tr> </thead> <tbody> <tr> <td>SYNC0 Interrupt</td> <td style="text-align: center">EIC_EXTINT0</td> </tr> <tr> <td>SYNC1 Interrupt</td> <td style="text-align: center">EIC_EXTINT1</td> </tr> <tr> <td>IRQ Interrupt</td> <td style="text-align: center">EIC_EXTINT7</td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Other Usage</th> <th style="text-align: center">Port Pin</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">SPI Chip Select</td> <td style="text-align: center">PORT RB11</td> </tr> <tr> <td style="text-align: center">Error Select Pin</td> <td style="text-align: center">PORT RB31</td> </tr> </tbody> </table></div> </li> </ul> <p><strong>NOTE</strong> - As per the Microcontroller and LAN9253 interrupt support, EIC/GPIO/PIO pins can be selected for External event registration and event handler processing.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/lan9253_configuration_option_withDiff_modes.png" alt="ethercat_mhc_image" /></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">SPI Cofiguration Mode Supported</th> <th style="text-align: center">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">ETHERCAT_SPI_INDIRECT_MODE_ACCESS</td> <td style="text-align: center">SPI Indirect Mode</td> </tr> <tr> <td style="text-align: center">ETHERCAT_SPI_DIRECT_MODE_ACCESS</td> <td style="text-align: center">SPI Direct Mode</td> </tr> <tr> <td style="text-align: center">ETHERCAT_SPI_BECKHOFF_MODE_ACCESS</td> <td style="text-align: center">SPI Beckhoff Mode</td> </tr> </tbody> </table></div> </li> <li> <p><strong>EIC</strong>, <strong>QSPI</strong> and <strong>TC0</strong> are configured as per the application requirement.</p> </li> <li> <p>These are the below PINs configured for the application</p> <ul> <li> <p><strong>QSPI PIN Configuration for EVB_LAN9253_SAMD51</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">QSPI Custom Name</th> <th style="text-align: center">Function</th> <th style="text-align: center">PORT PIN ID</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">QSPI_MOSI</td> <td style="text-align: center">QSPI_DATA0</td> <td style="text-align: center">PA08</td> </tr> <tr> <td style="text-align: center">QSPI_MISO</td> <td style="text-align: center">QSPI_DATA1</td> <td style="text-align: center">PA09</td> </tr> <tr> <td style="text-align: center">QSPI_SCK</td> <td style="text-align: center">QSPI_SCK</td> <td style="text-align: center">PB10</td> </tr> <tr> <td style="text-align: center">SPI_CS</td> <td style="text-align: center">GPIO</td> <td style="text-align: center">PB11</td> </tr> </tbody> </table></div> </li> <li> <p><strong>PIN Configuration for EtherCAT External Interrupt Pins for EVB_LAN9253_SAMD51</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">EIC Custom Name</th> <th style="text-align: center">EIC Channel</th> <th style="text-align: center">Port Pin</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">EIC_EXTINT0</td> <td style="text-align: center">EIC_EXTINT0</td> <td style="text-align: center">PORT PB16</td> </tr> <tr> <td style="text-align: center">EIC_EXTINT1</td> <td style="text-align: center">EIC_EXTINT1</td> <td style="text-align: center">PORT PB17</td> </tr> <tr> <td style="text-align: center">EIC_EXTINT7</td> <td style="text-align: center">EIC_EXTINT7</td> <td style="text-align: center">PORT PB23</td> </tr> </tbody> </table></div> </li> </ul> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/required_pin_configuration.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>Open <strong>NVIC configuration</strong> window from MHC→Tools. The QSPI Interrupt Priority Level to 2 and it is below to the configured parameter of the <strong>EtherCAT Interrupt Priority Level</strong> from <strong>LAN9253</strong> component .</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/nvic_QSPI_priority_change.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>The application will use the default clock options. No changes are required in clock settings.</p> </li> <li> <p>Generate the code by clicking the <strong>Generate Code</strong> button (marked in red).</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_demo_project_generation_lan9253_1.png" alt="ethercat_mhc_image" /></p> </li> <li> <p>This following diagram presents the One Click generated EtherCAT project, which is without Slave stack code except <strong>sample_app.c</strong> file. Slave stack code will be generated using SSC tool with the required configuration and Microchip-SAMD51-EtherCAT-Slave_SSC_Config.xml file. Right side is the EtherCAT project with supported SSC stack files.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/generated_slave_stack_code.png" alt="ethercat_mhc_image" /></p> </li> </ol> <h2 id="building-the-ethercat-application"> <a href="#building-the-ethercat-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>Building The EtherCAT Application</strong> </h2> <p>This section identifies the MPLAB X IDE projects for the <strong>ethercat_counter_foe_app</strong> demonstration application. The following table list the MPLAB X projects available for this demonstration. These projects are available inside <strong>&lt; install-dir &gt;/ethercat/apps/ethercat_counter_foe_app/firmware</strong> .</p> <ol> <li> <p>MPLABx project table</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Project Name</th> <th style="text-align: center">Target Device</th> <th style="text-align: center">Target Development board</th> <th style="text-align: center">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">sam_d51_lan9253_evb.X</td> <td style="text-align: center">ATSAMD51J19A</td> <td style="text-align: center">EVB-LAN9253_SAMD51</td> <td style="text-align: center">ETherCAT evaluation board with LAN9253</td> </tr> </tbody> </table></div> </li> <li> <p>At this point, the project will contain the MPLAB® Harmony components required for an EtherCAT application. The EtherCAT application files can now be added to the project.</p> <p>The MPLAB® Harmony EtherCAT repository contains an EtherCAT demo application. The source files for which are available in <strong>Harmony_Repo_Path/h3/ethercat/apps/ethercat_counter_foe_app/firmware/src</strong>.</p> </li> <li> <p>The <strong>app_lan9253.c</strong>, <strong>app.h</strong>, <strong>main.c</strong> files are updated to demonstrate the application.</p> </li> <li> <p>The <strong>apps\ethercat_counter_foe_app\firmware\src\config\samd51_lan9253_evb\ethercat_foe.ld</strong> linker file is a modified linker file which is used for FOE application. <strong>ROM_LENGTH</strong> of the linker file is modified to 0x40000 for ATSAMD51J19A. The memory mapped for Bank A is from 0x00000 to 0x3FFFF and the memory mapped for Bank B is from 0x40000 to 0x7FFFF.</p> <p>The <strong>Dual Bank</strong> feature enables a FoE firmware to execute from the NVM and at the same time the program to the flash with a new version of itself.After programming is completed the <strong>APP_BankSwitch()</strong> application function is used to swap the banks and to reset the device. <strong>APP_RunApplication()</strong> is sued to run the new firmware to be executed.</p> </li> <li> <p>The sample application files <strong>sample_app.c</strong>, <strong>sample_app.h</strong> and <strong>sample_appObjects.h</strong> which are generated by SSC tool and are updated for the application requirement.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/ethercat_sample_app.png" alt="ethercat_build_application" /></p> <p>These are the above files which are already shared with EtherCAT <strong>ethercat_counter_foe_app</strong> demo release.</p> </li> <li> <p>Verify the <strong>XC32</strong> Compiler Toolchain version and set the <strong>Connected Hardware Tool</strong> to <strong>ICD4</strong> or <strong>PICkit 3</strong>. Press <strong>Apply</strong> button and then press <strong>OK</strong> button.</p> </li> <li> <p>Build the application by clicking on the <strong>Build Main Project</strong>.</p> </li> </ol> <h2 id="running-the-application"> <a href="#running-the-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>Running The Application</strong> </h2> <h3 id="slave-stack-code-ssc-generation"> <a href="#slave-stack-code-ssc-generation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>Slave Stack Code (SSC) Generation</strong> </h3> <p><a href="../../../apps/docs/readme_ssctool.html">Steps to generate Slave Stack Code </a></p> <h3 id="twincat-manager-and-microchip-ethercat-slave-communication"> <a href="#twincat-manager-and-microchip-ethercat-slave-communication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> <strong>TwinCAT Manager and Microchip EtherCAT Slave communication</strong> </h3> <h4 id="twincat-ethercat-interface-detect-and-eeprom-programming"> <a href="#twincat-ethercat-interface-detect-and-eeprom-programming" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> TwinCAT EtherCAT interface detect and EEPROM Programming </h4> <ol> <li> <p>Upon successful installation of the TwinCAT Manager, the network adapter will be moved to Installed and ready to use devices section as shown in the following figure.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/eth_adapter_ready_to_use.png" alt="Application_Execut" /></p> <p>Please find the below table for the available Slave configuration files which are generated by SSC tool.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Slave Configuration File</th> <th style="text-align: center">Mode</th> </tr> </thead> <tbody> <tr> <td>SAMD51_SPI_Indirect_Mode.xml</td> <td style="text-align: center">SPI Indirect mode</td> </tr> <tr> <td>SAMD51_SPI_Direct_mode.xml</td> <td style="text-align: center">SPI Direct mode</td> </tr> <tr> <td>MSAMD51_SPI_Beckhoff_mode.xml</td> <td style="text-align: center">SPI Beckhoff mode</td> </tr> </tbody> </table></div> <p>Copy the required configuration file as per the configuration mode is selected during MHC <strong>Lan9253 Component</strong> configuration from <strong>&lt; harmony-repo &gt;/ethercat/slave_stack/lan9253/</strong> directory to the <strong>TwinCAT\3.1\Config\Io\EtherCAT</strong> directory.</p> </li> <li> <p>In TwinCAT XAE, create a New Project <strong>(File=&gt;New=&gt;Project)</strong>. In the New Project Window, select the TwinCAT Projects option and then click OK</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_new_project.png" alt="Application_Execute" /></p> </li> <li> <p>Connect Port zero of the device to the EtherCAT master using a RJ45 Ethernet cable, and then power up the board. The Link/Act LED should be ON at Port zero when the cable is connected. If the Link/Act LED is not ON, this indicates that there is an issue with the connection or the cable.</p> </li> <li> <p>Expand the IO option in the TwinCAT XAE project window and right click on Devices. Select Scan.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_scan_new_devices.png" alt="Application_Execute" /></p> </li> <li> <p>Click OK if the TwinCAT network interface is selected and continue scanning as shown in the below image.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/scanned_twincat_network_interface.png" alt="Application_Execute" /></p> </li> <li> <p>Click OK to continue scanning and Click Yes in the Scan for boxes prompt.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/device_confirmation_box.png" alt="Application_Execute" /></p> </li> <li> <p><strong>EEPROM Programming</strong> After a successful scan, click on Device 2 (EtherCAT) in the solution explorer window of the TwinCAT tool and Click Online in the TwinCAT project window. Once this is done, highlight the Device, and it should read OP.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_eeprom_update.png" alt="Application_Execute" /></p> </li> </ol> <h4 id="trigger-and-counter-demonstration"> <a href="#trigger-and-counter-demonstration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Trigger and Counter Demonstration </h4> <ol> <li> <p><strong>Input Trigger configuration</strong> - From I/O level on the Solution Explorer (left window), go to <strong>Devices=&gt;Device # (EtherCAT)=&gt;Box 1 (SAMD51 EtherCAT Slave)=&gt;Outputs</strong> process data <strong>mapping=&gt;Trigger</strong>.</p> </li> <li> <p>In the top center window, select Online tab. Click Write and then enter <strong>1</strong> in Decimal: field and click OK.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_start_trigger.png" alt="Application_Execute" /></p> </li> <li> <p><strong>Output Counter Observation</strong> - From I/O level on the Solution Explorer (left window), go to Devices=&gt;Device # (EtherCAT)=&gt;Box 1 (SAMD51 EtherCAT Slave)=&gt;Inputs process data mapping=&gt;Counter.</p> </li> <li> <p>In the top center window, select Online tab. The counter should be incrementing.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/twincat_output_counter.png" alt="Application_Execute" /></p> </li> </ol> <h4 id="file-over-ethercat-communication"> <a href="#file-over-ethercat-communication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> File over EtherCAT communication </h4> <ol> <li> <p><strong>FoE (File over EtherCAT) Test Update</strong> - Click on Box1, Select “Online” tab. Before FoE test <strong>Curent state</strong> and <strong>Requested state</strong> should be in <strong>OP</strong> mode.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/before_foe.png" alt="Application_Execute" /></p> </li> <li> <p>For file download, change the mode from INIT to BOOT mode.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/init_to_boot_mode.png" alt="Application_Execute" /></p> </li> <li> <p>After clicking <strong>Download</strong> button , select <strong>BIN</strong> file that need to be downloaded and configure the <strong>Password</strong> as per the <strong>EtherCAT component password</strong> configuration.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/download_bin_file_using_foe.png" alt="Application_Execute" /></p> <p>One can find the sample <strong>BIN</strong> files in <strong>&lt; harmony-repo &gt;/ethercat/apps/ethercat_counter_foe_app/firmware/src\FoE_Bin_imagefiles\lan9253_foe_binfiles</strong> which can be used for the FoE verification.</p> <p><strong>NOTE</strong> - One can generate <strong>BIN</strong> file from the generated EtheCAT <strong>HEX</strong> image after configuring the <strong>Project Properties-&gt;Conf:-&gt;Building-&gt;Execute This Line After Build</strong> ${MP_CC_DIR}/xc32-objcopy” -I ihex -O binary “${DISTDIR}/${PROJECTNAME}.${IMAGE_TYPE}.hex” “${DISTDIR}/${PROJECTNAME}.${IMAGE_TYPE}.bin</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/HextoBinFileConversion.png" alt="Application_Execute" /></p> <p><strong>NOTE</strong> - Please uncheck <strong>Execute This Line After Build</strong> option for a debug session of this project.</p> </li> <li> <p>The download process can be tracked as shown in the figure below-</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/download_bin_file_is_is_process.png" alt="Application_Execute" /></p> </li> <li> <p>After successful download, change the state from BOOT to INIT mode. This helps the application switch the bank from BANK B to BANK A and the newly downloaded firmware will be executed from BANK A. The new application starts running from flash location 0x0.</p> <p><img src="../../../apps/ethercat_counter_foe_app/docs/images/after_file_download_boot_to_init_mode.png" alt="Application_Execute" /></p> </li> </ol> <hr> <footer role="contentinfo"> <p class="text-small text-grey-dk-000 mb-0"><img src='../../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2020 Microchip Technology.</p> </footer> </div> </div> </div> </div> </body> </html>
