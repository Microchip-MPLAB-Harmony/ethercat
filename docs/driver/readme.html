<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>EtherCAT LAN925x Library | EtherCAT Library and Applications</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="EtherCAT LAN925x Library" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 EtherCAT package" /> <meta property="og:description" content="Harmony 3 EtherCAT package" /> <link rel="canonical" href="../driver/readme.html" /> <meta property="og:url" content="../driver/readme.html" /> <meta property="og:site_name" content="EtherCAT Library and Applications" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"EtherCAT LAN925x Library","url":"../driver/readme.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 EtherCAT package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../" class="nav-list-link">EtherCAT Library and Applications</a><ul class="nav-list "><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../driver/readme.html" class="nav-list-link active">EtherCAT LAN925x Library</a><ul class="nav-list"><li class="nav-list-item "> <a href="../driver/docs/readme_drvlan9252.html" class="nav-list-link">EtherCAT LAN9252 Library</a> </li><li class="nav-list-item "> <a href="../driver/docs/readme_drvlan9253.html" class="nav-list-link">EtherCAT LAN9253 Library</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../apps/ethercat_counter_foe_app/readme.html" class="nav-list-link">EtherCAT Counter FoE Application</a><ul class="nav-list"><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html" class="nav-list-link">EVB LAN9252 SAMD51 Application</a> </li><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html" class="nav-list-link">EVB LAN9253 SAMD51 Application</a> </li></ul></li><li class="nav-list-item "><a href="../apps/docs/readme_ssctool.html" class="nav-list-link">Slave Stack Code Generation</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search EtherCAT Library and Applications" aria-label="Search EtherCAT Library and Applications" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../index.html">EtherCAT Library and Applications</a></li> <li class="breadcrumb-nav-list-item"><span>EtherCAT LAN925x Library</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="Microchip logo" /></a> <img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small" /></p> <h1 id="ethercat-lan925x-library"> <a href="#ethercat-lan925x-library" aria-labelledby="ethercat-lan925x-library" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> EtherCAT LAN925x Library </h1> <p>EtherCAT LAN925x slave device software utility framework is a layered software framework that enables other PIC and Cortex Microcontroller peripherals to work together.</p> <ul> <li> <p><strong>LAN925x EtherCAT Framework</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">EtherCAT Slave Framework</th> <th style="text-align: center">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: center"><a href="../driver/docs/readme_drvlan9252.html">LAN9252 EtherCAT Framework</a></td> <td style="text-align: center">The Framework explains about EtherCAT slave controller Interface layer w.r.t LAN9252 device</td> </tr> <tr> <td style="text-align: center"><a href="../driver/docs/readme_drvlan9253.html">LAN9253 EtherCAT Framework</a></td> <td style="text-align: center">The Framework explains about EtherCAT slave controller Interface layer w.r.t LAN9253 device</td> </tr> </tbody> </table></div> </li> </ul> <p>Ethernet for Control Automation Technology (EtherCAT) was developed by Beckhoff. EtherCAT is a fast and deterministic network, and processes data using dedicated hardware and software. It uses a full duplex, master-slave configuration.</p> <p>The LAN925x is a 2/3-port EtherCAT slave controller with dual integrated Ethernet PHYs which each contain a fullduplex 100BASE-TX transceiver and support 100Mbps (100BASE-TX) operation.</p> <p>Use of the Microchip EVB-LAN925x (and similar EtherCAT interface devices) requires use of the Beckhoff EtherCAT Slave Stack Code (SSC) and its associated configuration and code generation tool.</p> <ul> <li>The <strong>interrupts</strong> have to be configured during hardware initialization. <ul> <li> <p><strong>PDI ( Process Data Interface ) Interrupt</strong> - The programmable system interrupts are generated internally by the various device sub-modules and can be configured to generate a single external host interrupt via the IRQ interrupt output pin. That is TwinCAT manager with enabled <strong>Synchron Synchronization</strong> mode.</p> </li> <li> <p><strong>DC - SYNC0 AND SYNC1</strong> - If the application running on the SOC requires Distributed Clock, then SYNC0 and SYNC1 should be connected to the microcontroller’s interrupts lines. Refer to LAN9252 datasheet for configuration of SYNC0 and SYNC1.</p> </li> <li> <p><strong>TIMER Interupt</strong> - SSC has a variable which will count every millisecond, which can be implemented either timer interrupt or polling method. The interrupt/polling mode can be selected in the SSC Tool before creating the slave stack code. SSC will access EtherCAT core registers from both interrupt context and polling mode. So, the ECAT_CSR_CMD and ECAT_CSR_DATA registers has to be protected against simultaneous access which can corrupt the state machine inside the slave stack code.</p> </li> </ul> </li> <li> <p><strong>Configure of Library</strong></p> <p>Configure the peripheral library using the MHC. EtherCAT Slave Device Indicators This section describes the LAN925x driver and EtherCAT trigger and counter variables are used to support visual inspection and troubleshooting of the driver and networks.</p> <ol> <li> <p><strong>PDO ( Process Data Object Trigger and Counter )</strong> - The PDO protocol is used for communication with External interrupt IRQ.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Index</th> <th style="text-align: center">Object</th> <th style="text-align: center">Type</th> <th style="text-align: center">Direction</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">1</td> <td style="text-align: center">0x6000</td> <td style="text-align: center">32bit Counter</td> <td style="text-align: center">TX</td> </tr> </tbody> </table></div> </li> <li> <p><strong>Receive PDO Mapping ( Outputs )</strong> - The PDO protocol is used for communication with External interrupt IRQ.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Index</th> <th style="text-align: center">Object</th> <th style="text-align: center">Type</th> <th style="text-align: center">Direction</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">1</td> <td style="text-align: center">0x7010</td> <td style="text-align: center">32bit Counter</td> <td style="text-align: center">RX</td> </tr> </tbody> </table></div> </li> <li> <p>Synchronization - The Beckhoff Slave Stack Code supports different modes of synchronization which are based on three physical signals: (PDI_)IRQ, Sync0 and Sync1 Microchip EtherCAT device also supports different modes.</p> <ul> <li> <p>Master and Slaves for synchronization: Free run The Master cycle time and Slave cycle time are independent.</p> </li> <li> <p>IRQ interrupt event is triggered from Master for SM-Synchron Synchronization.</p> </li> <li> <p>Both IRQ and SYNC0 event occurs for the DC-Synchron operation mode and SYNC0 and SYNC1 unit cycle time is configured 1000µs.</p> </li> </ul> </li> </ol> </li> <li> <p><strong>Using Library</strong></p> <p>File over EtherCAT (FoE) - Architecture – Host/Slave interaction states for firmware update. The Dual Bank feature enables a firmware to execute from the NVM and at the same time the program to the flash with a new version of itself. After programming is completed the APP_BankSwitch() application function is used to swap the banks and to reset the device.</p> <p><img src="../driver/docs/images/Firmware_upgrade.png" alt="library usage" /></p> <p>FOE demostartion with respect to ATSAMD51J19A device -</p> <p><img src="../driver/docs/images/D51Bankdetails.png" alt="library usage" /></p> <ul> <li> <p>Master changes from INIT to BOOT, then download of a file initiated. When state changes from INIT to BOOT, slave or the FoE application is ready to write the new FW or bin file at the BankB location( 0x40000 Bank B location for ATSAMD51j19A device ). Flag gFirmwareDownload_Started set to 1.</p> </li> <li> <p>Master initiates Download command with default password value as <strong>0x11223344</strong> and bin file (this file is generated from the existing D51 foe studio project). In the slave FOE_FILEDOWNLOAD_PASSWORD is set to 0x11223344 and can be modified from EtherCAT MHC component configuration. FoE_Write() checks file name size ( limited to 16) and checks password value and then proceed to FoE_WriteData().</p> </li> <li> <p>Once Master completes bin file transfer, then Master need to change the state from BOOT to INIT. In the FW application or slave code, APP_FW_GetDownloadStateFinished() changes state to gFirmwareDownload_Started = 0 and APP_FW_StateBOOTtoINIT() changes gFirmwareDownload_Finished = 1.</p> </li> <li> <p>Once State changes from BOOT to INIT, Slave application initiates bank switch application(APP_BankSwitch()) and software reset(run_application()). Then Bank A moves to BANK B location and the new application stored in BANK B , moved to BANK A with flash location 0x0. The new application starts running from flash location 0x0 and will be ready with new application.</p> </li> </ul> <p>SSC tool FoE configuration -</p> <p><img src="../driver/docs/images/SSCtool_FoE_configuration.png" alt="library usage" /></p> </li> </ul> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2020 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
