<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>EtherCAT LAN925x Library | EtherCAT Library and Applications</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="EtherCAT LAN925x Library" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 EtherCAT package" /> <meta property="og:description" content="Harmony 3 EtherCAT package" /> <link rel="canonical" href="../driver/readme.html" /> <meta property="og:url" content="../driver/readme.html" /> <meta property="og:site_name" content="EtherCAT Library and Applications" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"EtherCAT LAN925x Library","url":"../driver/readme.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 EtherCAT package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../index.html" class="nav-list-link">EtherCAT Library and Applications</a><ul class="nav-list "><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../driver/readme.html" class="nav-list-link active">EtherCAT LAN925x Library</a><ul class="nav-list"><li class="nav-list-item "> <a href="../driver/docs/readme_drvlan9252.html" class="nav-list-link">EtherCAT LAN9252 Library</a> </li><li class="nav-list-item "> <a href="../driver/docs/readme_drvlan9255.html" class="nav-list-link">EtherCAT LAN9255 Library</a> </li><li class="nav-list-item "> <a href="../driver/docs/readme_drvlan9253.html" class="nav-list-link">EtherCAT LAN9253 Library</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../apps/ethercat_counter_foe_app/readme.html" class="nav-list-link">EtherCAT Counter FoE Application</a><ul class="nav-list"><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9252_samd51.html" class="nav-list-link">EVB LAN9252 SAMD51 Application</a> </li><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51.html" class="nav-list-link">EVB LAN9253 SAMD51 Application</a> </li><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9253_samd51_sqi.html" class="nav-list-link">EVB LAN9253 SAMD51 Application SQI Communication</a> </li><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9255_same53_spi.html" class="nav-list-link">EVB LAN9255 SAME53 Application SPI Communication</a> </li><li class="nav-list-item "> <a href="../apps/ethercat_counter_foe_app/docs/readme_lan9255_same53_sqi.html" class="nav-list-link">EVB LAN9255 SAME53 Application SQI Communication</a> </li></ul></li><li class="nav-list-item "><a href="../apps/docs/readme_ssctool.html" class="nav-list-link">Slave Stack Code Generation</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search EtherCAT Library and Applications" aria-label="Search EtherCAT Library and Applications" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../index.html">EtherCAT Library and Applications</a></li> <li class="breadcrumb-nav-list-item"><span>EtherCAT LAN925x Library</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="Microchip logo" /></a> <img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small" /></p> <h1 id="ethercat-lan925x-library"> <a href="#ethercat-lan925x-library" aria-labelledby="ethercat-lan925x-library" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> EtherCAT LAN925x Library </h1> <p>EtherCAT LAN925x Client device software utility framework is a layered software framework designed to operate with different PIC and Cortex Microcontroller peripherals.</p> <ul> <li> <p><strong>LAN925x EtherCAT Framework</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">EtherCAT Client Framework</th> <th style="text-align: center">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: center"><a href="../driver/docs/readme_drvlan9252.html">LAN9252 EtherCAT Framework</a></td> <td style="text-align: center">This Framework implements a EtherCAT Client Controller Interface layer for the LAN9252 device</td> </tr> <tr> <td style="text-align: center"><a href="../driver/docs/readme_drvlan9253.html">LAN9253 EtherCAT Framework</a></td> <td style="text-align: center">This Framework implements a EtherCAT Client Controller Interface layer for the LAN9253 device</td> </tr> <tr> <td style="text-align: center"><a href="../driver/docs/readme_drvlan9255.html">LAN9255 EtherCAT Framework</a></td> <td style="text-align: center">This Framework implements a EtherCAT Client Controller Interface layer for the LAN9255 device</td> </tr> </tbody> </table></div> </li> </ul> <p>Ethernet for Control Automation Technology (EtherCAT) was developed by Beckhoff. EtherCAT is a fast and deterministic network. It processes data using dedicated hardware and software. It is based on a full duplex, manager(TwinCAT Manager)-client(LAN925x Client) configuration.</p> <p>The LAN925x is a 2/3-port EtherCAT client controller with dual integrated Ethernet PHYs which each contain a fullduplex 100BASE-TX transceiver and support 100Mbps (100BASE-TX) operation.</p> <p>Use of the Microchip EVB-LAN925x (and similar EtherCAT interface devices) requires use of the Beckhoff EtherCAT Slave Stack Code (SSC) and its associated configuration and code generation tool.</p> <ul> <li>The <strong>interrupts</strong> have to be configured during hardware initialization. <ul> <li> <p><strong>PDI ( Process Data Interface ) Interrupt</strong> - This is a programmable interrupt. It is triggered via the TwinCAT manager by enabling the <strong>Synchron Synchronization</strong> mode. There are various operational modes in the LAN925x device that can cause this interrupt.</p> </li> <li> <p><strong>DC - SYNC0 AND SYNC1</strong> - If the application running on the micrcontroller requires Distributed Clock, then LAN925x SYNC0 and SYNC1 pins should be connected to the microcontroller’s external interrupt lines. Refer to LAN9252 datasheet for configuration of SYNC0 and SYNC1.</p> </li> <li> <p><strong>TIMER Interupt</strong> - The SSC employs a variable that counts up every one millisecond by default. This variable can be accessed via an interrupt or a polling method. If accessed via an interrupt, the interrupt occurs every one millisecond. The interrupt/polling mode can be selected in the SSC Tool before generating the Beckhoff slave stack code. It should be noted that the SSC will access EtherCAT ECAT_CSR_CMD and ECAT_CSR_DATA core registers from both interrupt context and polling mode. This can corrupt the SSC state machine. These registers should therefore be protected against simultaneous access.</p> </li> </ul> </li> <li> <p><strong>SSC Library Configuration</strong></p> <p>The SSC provides a set of EtherCAT Client Device Indicators. These indicators are composed of an Ethercat Trigger and counter variable. These indicators support visual inspection and troubleshooting of the driver and the Ethercat Network. This section contains additional details about these indicators.</p> <ol> <li> <p><strong>PDO ( Process Data Object Trigger and Counter )</strong> - The PDO protocol is used for communication with External interrupt IRQ.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Index</th> <th style="text-align: center">Object</th> <th style="text-align: center">Type</th> <th style="text-align: center">Direction</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">1</td> <td style="text-align: center">0x6000</td> <td style="text-align: center">32bit Counter</td> <td style="text-align: center">TX</td> </tr> </tbody> </table></div> </li> <li> <p><strong>Receive PDO Mapping ( Outputs )</strong> - The PDO protocol is used for communication with External interrupt IRQ.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Index</th> <th style="text-align: center">Object</th> <th style="text-align: center">Type</th> <th style="text-align: center">Direction</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">1</td> <td style="text-align: center">0x7010</td> <td style="text-align: center">32bit Counter</td> <td style="text-align: center">RX</td> </tr> </tbody> </table></div> </li> </ol> </li> <li> <p><strong>Using the Library</strong></p> <p>This section provides details about the File Over EtherCAT (FoE) protocol and EEPROM Emulation Configuration in this library.</p> <p>The below flowchart depicts the Host/Client interaction during a Firmware Update operation. The microcontroller Flash Dual Bank feature enables a firmware to execute from one bank while the other Flash bank is programmed with a Firmware Update. The APP_BankSwitch() application function is called to swap the banks and to reset the device when the programming is complete.</p> <p><img src="../driver/docs/images/Firmware_upgrade.png" alt="library usage" /></p> <p>The below figure shows the Dual Bank organization used by FOE demonstration on a ATSAMD51J19A device.</p> <p><img src="../driver/docs/images/D51Bankdetails.png" alt="library usage" /></p> <p>The firmware upgrade is performed as follows:</p> <ul> <li> <p>Selecting the Bootstrap option in the TwinCAT manager changes the state machine state from INIT to BOOT and initiates a file download. The SSC code receives intimation to change mode from INIT to BOOT and gets ready to write the new firmware to Bank B location (0x40000 on the ATSAMD51j19A device ). The gFirmwareDownload_Started flag set to 1.</p> </li> <li> <p>The TwinCAT manager downloads the password (default value as <strong>0x11223344</strong>) and the firrmware binary file. This file is generated from the existing ATSAMD51J19A FoE ATMEL Studio IDE project. In the SSC stack, the FOE_FILEDOWNLOAD_PASSWORD configuration constant is set to 0x11223344. This constant can be modified through the EtherCAT component in MPLAB Harmony Configurator (MHC). The FoE_Write() function checks the file name size (this is limited to 16 characters), verifies the password and then proceeds to call the FoE_WriteData() function.</p> </li> <li> <p>After completing the file transfer, the TwinCAT manager state is changed from BOOT to INIT. This triggers the APP_FW_GetDownloadStateFinished() function in the client firmware changes. The gFirmwareDownload_Started flag is cleared and the APP_FW_StateBOOTtoINIT() function sets the gFirmwareDownload_Finished flag to 1.</p> </li> <li> <p>After the state change from BOOT to INIT is complete, the Client application initiates a bank switch ( by calling the APP_BankSwitch() function) and then performs a software reset(by calling the run_application() function). This causes the execution of the application stored in BANK B location. The Bank B location is now treated as Bank A and the start location of Bank B is treated as location 0x0 of Bank A. The execution of the downloaded updated application will start.</p> </li> </ul> <p>SSC tool FoE configuration -</p> <p><img src="../driver/docs/images/SSCtool_FoE_configuration.png" alt="library usage" /></p> <ul> <li>For SSC tool EEPROM emulation ,select Hardware in Slave Project Navigation Window and make sure ESC_EEPROM_SIZE is 0x800, ESC_EEPROM_EMULATION is 1 &amp; CREATE_EEPROM_CONTENT is 0.</li> </ul> <p>SSC tool EEPROM Configuration -</p> <p><img src="../driver/docs/images/ethercat_eeprom_emulation_configuration.png" alt="library usage" /></p> </li> </ul> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
