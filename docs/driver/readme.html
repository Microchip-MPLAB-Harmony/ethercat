<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>EtherCAT LAN925x Library - EtherCAT Library and Applications</title> <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-2724382-16"); </script> <script type="text/javascript" src="../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>EtherCAT LAN925x Library | EtherCAT Library and Applications</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="EtherCAT LAN925x Library" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 EtherCAT package" /> <meta property="og:description" content="Harmony 3 EtherCAT package" /> <link rel="canonical" href="../driver/readme.html" /> <meta property="og:url" content="../driver/readme.html" /> <meta property="og:site_name" content="EtherCAT Library and Applications" /> <script type="application/ld+json"> {"@type":"WebPage","url":"../driver/readme.html","headline":"EtherCAT LAN925x Library","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 EtherCAT package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="../mplab_harmony_license.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../release_notes.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../index.html" class="navigation-list-link">EtherCAT Library and Applications</a><ul class="navigation-list-child-list "><li class="navigation-list-item active"><a href="../driver/readme.html" class="navigation-list-link active">EtherCAT LAN925x Library</a></li><li class="navigation-list-item "><a href="../apps/ethercat_counter_foe_app/readme.html" class="navigation-list-link">EtherCAT Counter FoE Application</a></li></ul></li><li class="navigation-list-item"><a href="../apps/docs/readme_ssctool.html" class="navigation-list-link">Slave Stack Code Generation</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search EtherCAT Library and Applications" aria-label="Search EtherCAT Library and Applications" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="https://support.microchip.com">Obtain Support from Microchip</a></li> </ul> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../index.html">EtherCAT Library and Applications</a></li> <li class="breadcrumb-nav-list-item"><span>EtherCAT LAN925x Library</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="Microchip logo" /></a> <img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small" /></p> <h1 id="ethercat-lan925x-library"> <a href="#ethercat-lan925x-library" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> EtherCAT LAN925x Library </h1> <p>Ethernet for Control Automation Technology (EtherCAT) was developed by Beckhoff. EtherCAT is a fast and deterministic network, and processes data using dedicated hardware and software. It uses a full duplex, master-slave configuration.</p> <p>The LAN925x is a 2/3-port EtherCAT slave controller with dual integrated Ethernet PHYs which each contain a fullduplex 100BASE-TX transceiver and support 100Mbps (100BASE-TX) operation.</p> <p>EtherCAT Slave Controller Interface layer is designed for Microchip MCUs to communicate with LAN9252 EtherCAT Slave controller. This EtherCAT framework is configured with the communication interfaces (QSPI ( SPI mode), GPIO). This communication Interface layer which will acts like bridge between EtherCAT Slave Stack Code (SSC) and Host peripherals to communicate with LAN9252. SSC Stack (generated from standard SSC tool) have feature to transfer the File over EtherCAT (FoE) for MCU firmware upgrade from TwinCAT tool.</p> <p><img src="../driver/docs/EtherCAT_module_diagram.png" alt="Ethercat Technology" /></p> <p>Use of the Microchip EVB-LAN9252 (and similar EtherCAT interface devices) requires use of the Beckhoff EtherCAT Slave Stack Code (SSC) and its associated configuration and code generation tool.</p> <ul> <li>The <strong>interrupts</strong> have to be configured during hardware initialization. <ul> <li> <p><strong>PDI Interrupt</strong> - The programmable system interrupts are generated internally by the various device sub-modules and can be configured to generate a single external host interrupt via the IRQ interrupt output pin. That is TwinCAT manager with enabled <strong>Synchron Synchronization</strong> mode.</p> </li> <li> <p><strong>DC - SYNC0 AND SYNC1</strong> - If the application running on the SOC requires Distributed clock, then SYNC0 and SYNC1 should be connected to the microcontroller’s interrupts lines. Refer to LAN9252 datasheet for configuration of SYNC0 and SYNC1.</p> </li> <li> <p><strong>TIMER Interupt</strong> - SSC has a variable which will count every millisecond, which can be implemented either timer interrupt or polling method. The interrupt/polling mode can be selected in the SSC Tool before creating the slave stack code. SSC will access EtherCAT core registers from both interrupt context and polling mode. So, the ECAT_CSR_CMD and ECAT_CSR_DATA registers has to be protected against simultaneous access which can corrupt the state machine inside the slave stack code.</p> </li> </ul> </li> <li> <p><strong>Configure of Library</strong> Configure the peripheral library using the MHC. EtherCAT Slave Device Indicators This section describes the LAN9252 driver and EtherCAT trigger and counter variables are used to support visual inspection and troubleshooting of the driver and networks.</p> <ol> <li> <p><strong>PDO ( Process Data Object Trigger and Counter )</strong> - The PDO protocol is used for communication with External interrupt IRQ.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Index</th> <th style="text-align: center">Object</th> <th style="text-align: center">Type</th> <th style="text-align: center">Direction</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">1</td> <td style="text-align: center">0x6000</td> <td style="text-align: center">32bit Counter</td> <td style="text-align: center">TX</td> </tr> </tbody> </table></div> </li> <li> <p><strong>Receive PDO Mapping ( Outputs )</strong> - The PDO protocol is used for communication with External interrupt IRQ. | Index | Object | Type | Direction | |:——:|:——-:|:—–:|:———:| |1|0x7010|32bit Counter|RX|</p> </li> <li> <p>Synchronization - The Beckhoff Slave Stack Code supports different modes of synchronization which are based on three physical signals: (PDI_)IRQ, Sync0 and Sync1 Microchip EtherCAT device also supports different modes.</p> <ul> <li>Master and Slaves for synchronization: Free run The Master cycle time and Slave cycle time are independent. &lt; This mode is Supported &gt;</li> <li>IRQ interrupt event tiggers Master and Slave for Synchron Synchronization. &lt; This mode is supported &gt;</li> <li>Synchronization with distributed clocks ( Both IRQ and SYNC0 event occurs), the Master cycle time and Slave cycle time are synchronized. &lt; This mode is supported &gt;</li> </ul> </li> </ol> </li> <li> <p><strong>Using Library</strong></p> <p>File over EtherCAT (FoE) - Architecture – Host/Slave interaction states for firmware update</p> <p><img src="../driver/docs/Firmware_upgrade.png" alt="library usage" /></p> <p>FOE demostartion with respect to ATSAMD51J19A device -</p> <p><img src="../driver/docs/D51Bankdetails.png" alt="library usage" /></p> <ul> <li> <p>Master changes from INIT to BOOT, then download of a file initiated. Wen state changes from INIT to BOOT, slave or the FoE application is ready to write the New FW or bin file at the BankB location. Flag gFirmwareDownload_Started set to 1.</p> </li> <li> <p>Master initiates Download command with password value as 0x11223344 and bin file (this file is generated from the existing D51 foe studio project). In the slave FOE_FILEDOWNLOAD_PASSWORD is set to 0x11223344. FoE_Write() checks file name size ( limited to 16) and checks password value and then proceed to FoE_WriteData().</p> </li> <li> <p>Once Master completes bin file transfer, then Master need to change the state from BOOT to INIT. In the FW application or slave code, APP_FW_GetDownloadStateFinished() changes state to gFirmwareDownload_Started = 0 and APP_FW_StateBOOTtoINIT() changes gFirmwareDownload_Finished = 1.</p> </li> <li> <p>Once State changes from BOOT to INIT, Slave application initiates bank switch application(APP_BankSwitch()) and software reset(run_application()). Then Bank A moves to BANK B location and the new application stored in BANK B , moved to BANK A with flash location 0x0. The new application starts running from flash location 0x0 and will be ready with new application.</p> </li> </ul> <p>SSC tool FoE configuration -</p> <p><img src="../driver/docs/SSCtool_FoE_configuration.png" alt="library usage" /></p> </li> </ul> <p><strong>Legal</strong> Please review the Software License Agreement (mplab_harmony_license.txt) prior to using MPLAB Harmony. It is the responsibility of the end-user to know and understand the software license agreement terms regarding the Microchip and third-party software that is provided in this installation. A copy of the agreement is available in the ethercat/doc folder of your MPLAB Harmony installation</p> <hr> <footer role="contentinfo"> <p class="text-small text-grey-dk-000 mb-0"><img src='../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2020 Microchip Technology.</p> </footer> </div> </div> </div> </div> </body> </html>
